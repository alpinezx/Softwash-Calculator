<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soft Wash Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .calculator {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .tabs {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }
        .tabs .tab {
            padding: 15px 30px;
            background-color: #95a5a6 !important;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            color: white !important;
            transition: all 0.3s;
            border-radius: 5px;
            text-align: center;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            body {
                margin: 20px auto;
                padding: 10px;
            }
            .calculator {
                padding: 20px;
            }
        }
        .tabs .tab:hover {
            background-color: #7f8c8d !important;
        }
        .tabs .tab.active {
            background-color: #34495e !important;
            color: white !important;
            border-bottom: 2px solid #34495e;
            margin-bottom: -2px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #34495e;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }
        input:focus {
            outline: none;
            border-color: #3498db;
        }
        button {
            width: 100%;
            padding: 15px;
            background-color: #34495e;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #2c3e50;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background-color: #ecf0f1;
            border-radius: 5px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .result-item {
            margin: 10px 0;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }
        .result-label {
            font-weight: bold;
            color: #2c3e50;
        }
        .result-value {
            color: #27ae60;
            font-size: 18px;
            font-weight: bold;
        }
        .warning {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #17a2b8;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>üß™ Soft Wash Calculator</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('sh')">Sodium Hypochlorite Calculator</button>
            <button class="tab" onclick="switchTab('ratio')">Chemical Ratio Calculator</button>
        </div>

        <!-- Sodium Hypochlorite Tab -->
        <div id="sh-tab" class="tab-content active">
        
        <div class="info">
            <strong>Note:</strong> This calculator helps you mix sodium hypochlorite (bleach) solutions for soft washing. Always wear appropriate PPE and follow safety guidelines.
        </div>

        <div class="input-group">
            <label for="unitToggle">Display Units:</label>
            <select id="unitToggle" onchange="convertTankSizeUnit()">
                <option value="litres">Litres (L)</option>
                <option value="millilitres">Millilitres (ml)</option>
                <option value="gallons">US Gallons (gal)</option>
                <option value="fluidounces">US Fluid Ounces (fl oz)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="tankSize">Total Amount to Make (<span id="tankSizeUnit">L</span>):</label>
            <input type="number" id="tankSize" value="5" min="1" step="0.1">
        </div>

        <div class="input-group">
            <label for="concentrate">Sodium Hypochlorite Concentrate Strength (%):</label>
            <input type="number" id="concentrate" value="15" min="0.1" max="15" step="0.1">
        </div>

        <div class="input-group">
            <label for="desired">Desired Final Strength (%):</label>
            <input type="number" id="desired" value="3" min="0.1" max="15" step="0.1">
        </div>

        <div class="input-group">
            <label for="surfactant">Surfactant (ml per litre of total mix):</label>
            <input type="number" id="surfactant" value="20" min="0" step="0.1">
            <small style="color: #666;">Average UK surfactants ~20ml/L | US surfactants ~8ml/L</small>
        </div>

        <button onclick="calculate()">Calculate Mix</button>
        <button onclick="resetSH()" style="background-color: #95a5a6; margin-top: 10px;">Reset to Defaults</button>

        <div id="results" class="results">
            <h2 style="color: #2c3e50; margin-top: 0;">Mix Recipe:</h2>
            
            <div class="result-item">
                <span class="result-label">Sodium Hypochlorite (<span id="concentrateDisplay"></span>%):</span>
                <div class="result-value"><span id="hypoLitres"></span> L (<span id="hypoMl"></span> ml)</div>
            </div>

            <div class="result-item">
                <span class="result-label">Water:</span>
                <div class="result-value"><span id="waterLitres"></span> L (<span id="waterMl"></span> ml)</div>
            </div>

            <div class="result-item">
                <span class="result-label">Surfactant:</span>
                <div class="result-value"><span id="surfactantMl"></span> ml (<span id="surfactantLitres"></span> L)</div>
            </div>

            <div class="result-item" style="background-color: #d4edda; border: 2px solid #28a745;">
                <span class="result-label">Total Volume:</span>
                <div class="result-value"><span id="totalLitres"></span> L</div>
            </div>

            <div class="result-item">
                <span class="result-label">Mix Ratio:</span>
                <div style="color: #2c3e50; font-weight: bold; font-size: 16px;">
                    <span id="ratio"></span>
                </div>
            </div>

            <div class="result-item" style="background-color: #e7f3ff; border: 2px solid #2196F3;">
                <span class="result-label">Dilution Ratio:</span>
                <div style="color: #1976D2; font-weight: bold; font-size: 16px;">
                    <span id="dilutionRatio"></span>
                </div>
                <small style="color: #666; display: block; margin-top: 5px;">
                    This is the ratio you're mixing for <span id="finalStrength"></span>% from <span id="concentrateStrength"></span>% concentrate
                </small>
            </div>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è Safety Warning:</strong> Always add sodium hypochlorite to water, never water to sodium hypochlorite. Wear appropriate PPE including gloves, eye protection, and protective clothing. Store chemicals safely and follow all local regulations.
        </div>
        
        </div>
        <!-- End Sodium Hypochlorite Tab -->

        <!-- chemical Ratio Mix Tab -->
        <div id="ratio-tab" class="tab-content">
        
        <div class="info">
            <strong>Note:</strong> This calculator is for ratio-based chemical mixes (e.g., sodium hypochlorite, biocides, general cleaners). Enter your desired ratio and total volume.
        </div>

        <div class="input-group">
            <label for="ratioUnitToggle">Display Units:</label>
            <select id="ratioUnitToggle" onchange="convertRatioVolumeUnit()">
                <option value="litres" selected>Litres (L)</option>
                <option value="millilitres">Millilitres (ml)</option>
                <option value="gallons">US Gallons (gal)</option>
                <option value="fluidounces">US Fluid Ounces (fl oz)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="ratioTotalVolume">Total Amount to Make (<span id="ratioVolumeUnit">L</span>):</label>
            <input type="number" id="ratioTotalVolume" value="5" min="0.1" step="0.1">
        </div>

        <div class="input-group">
            <label>Mix Ratio (<span style="color: #FF9800; font-weight: bold;">Chemical</span> : <span style="color: #2196F3; font-weight: bold;">Diluent</span>):</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="number" id="ratioChemical" value="1" min="0.1" step="0.1" style="width: 100px; border: 2px solid #FF9800; font-weight: bold; color: #FF9800;">
                <span style="font-weight: bold; font-size: 20px;">:</span>
                <input type="number" id="ratioWater" value="1" min="0.1" step="0.1" style="width: 100px; border: 2px solid #2196F3; font-weight: bold; color: #2196F3;">
            </div>
            <div style="background-color: #ffebee; border: 2px solid #f44336; padding: 12px; border-radius: 5px; margin-top: 10px; font-size: 14px; color: #c62828; font-weight: 500;">
                <strong>‚ö†Ô∏è IMPORTANT - Diluent:</strong> Always check product specifications for the correct liquid to use as a diluent (water, solvent, etc.). Using the wrong diluent can be dangerous.
                <br><br>
                <strong>‚ö†Ô∏è IMPORTANT - Ratio Format:</strong> Some product labels invert the ratio of chemical to diluent (e.g., 1:3 vs 3:1). Please ensure your ratio is correct before calculating.
            </div>
        </div>

        <button onclick="calculateRatio()">Calculate Mix</button>
        <button onclick="resetRatio()" style="background-color: #95a5a6; margin-top: 10px;">Reset to Defaults</button>

        <div id="ratio-results" class="results">
            <h2 style="color: #2c3e50; margin-top: 0;">Mix Recipe:</h2>
            
            <div class="result-item">
                <span class="result-label">Chemical:</span>
                <div class="result-value"><span id="ratioChemicalAmount"></span></div>
            </div>

            <div class="result-item">
                <span class="result-label">Diluent:</span>
                <div class="result-value"><span id="ratioWaterAmount"></span></div>
            </div>

            <div class="result-item" style="background-color: #d4edda; border: 2px solid #28a745;">
                <span class="result-label">Total Volume:</span>
                <div class="result-value"><span id="ratioTotalAmount"></span></div>
            </div>
        </div>

        <div class="warning">
            <strong>‚ö†Ô∏è Safety Warning:</strong> Always add chemicals to water, never water to chemicals. Wear appropriate PPE including gloves, eye protection, and protective clothing. Store chemicals safely and follow all local regulations.
        </div>

        </div>
        <!-- End Chemical Ratio Mix Tab -->
        
        <div style="text-align: center; margin-top: 15px; padding: 15px; background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 5px;">
            <p style="margin: 0; color: #856404; font-size: 13px; line-height: 1.6;">
                <strong>Disclaimer:</strong> This calculator is provided as-is for informational purposes only. Users are solely responsible for verifying all calculations, following manufacturer specifications, and ensuring safe handling of chemicals. Use at your own risk. The creator accepts no liability for any damages, injuries, or losses resulting from use of this calculator.
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 15px; padding: 15px; background-color: #f8f9fa; border-radius: 5px; border: 1px solid #dee2e6;">
            <p style="margin: 0; color: #495057; font-size: 14px;">
                Created by <strong>alpinezx</strong> | 
                <a href="https://github.com/alpinezx/Softwash-Calculator" target="_blank" style="color: #3498db; text-decoration: none; font-weight: bold;">View on GitHub</a>
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 20px; padding: 10px; color: #666; font-size: 12px; border-top: 1px solid #ddd;">
            <strong>Note:</strong> Security browser extensions (e.g., NoScript, uBlock Origin) may interfere with this calculator. If the Calculate button doesn't work, please whitelist this page or temporarily disable script blockers.
        </div>
    </div>

    <script>
        // Tab switching function
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            if (tabName === 'sh') {
                document.getElementById('sh-tab').classList.add('active');
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tabName === 'ratio') {
                document.getElementById('ratio-tab').classList.add('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            }
        }

        // Chemical ratio calculator function
        let calculatedRatioChemical = 0;
        let calculatedRatioWater = 0;
        let calculatedRatioTotal = 0;
        let previousRatioUnit = document.getElementById('ratioUnitToggle') ? document.getElementById('ratioUnitToggle').value : 'litres';

        function convertRatioVolumeUnit() {
            const currentUnit = document.getElementById('ratioUnitToggle').value;
            const volumeInput = document.getElementById('ratioTotalVolume');
            const unitLabel = document.getElementById('ratioVolumeUnit');
            let currentValue = parseFloat(volumeInput.value);

            // If no change, do nothing
            if (previousRatioUnit === currentUnit) {
                return;
            }

            // Determine if we're switching between UK and US systems or within a system
            const ukUnits = ['litres', 'millilitres'];
            const usUnits = ['gallons', 'fluidounces'];
            
            const previousIsUK = ukUnits.includes(previousRatioUnit);
            const currentIsUK = ukUnits.includes(currentUnit);
            const previousIsUS = usUnits.includes(previousRatioUnit);
            const currentIsUS = usUnits.includes(currentUnit);

            // Switching between UK and US systems - reset to defaults
            if ((previousIsUK && currentIsUS) || (previousIsUS && currentIsUK)) {
                // Hide results when switching between systems
                document.getElementById('ratio-results').classList.remove('show');
                calculatedRatioChemical = 0;
                calculatedRatioWater = 0;
                calculatedRatioTotal = 0;
                
                if (currentIsUS) {
                    // Switching to US system
                    if (currentUnit === 'fluidounces') {
                        volumeInput.value = 640; // 5 gallons = 640 fl oz
                    } else {
                        volumeInput.value = 5;
                    }
                    unitLabel.textContent = currentUnit === 'fluidounces' ? 'fl oz' : 'gal';
                } else {
                    // Switching to UK system
                    if (currentUnit === 'millilitres') {
                        volumeInput.value = 5000;
                    } else {
                        volumeInput.value = 5;
                    }
                    unitLabel.textContent = currentUnit === 'millilitres' ? 'ml' : 'L';
                }
            }
            // Converting within UK system (litres ‚Üî millilitres)
            else if (previousIsUK && currentIsUK) {
                if (!isNaN(currentValue) && currentValue > 0) {
                    if (previousRatioUnit === 'litres' && currentUnit === 'millilitres') {
                        volumeInput.value = (currentValue * 1000).toFixed(0);
                    } else if (previousRatioUnit === 'millilitres' && currentUnit === 'litres') {
                        volumeInput.value = parseFloat((currentValue / 1000).toFixed(2));
                    }
                }
                unitLabel.textContent = currentUnit === 'millilitres' ? 'ml' : 'L';
            }
            // Converting within US system (gallons ‚Üî fluid ounces)
            else if (previousIsUS && currentIsUS) {
                if (!isNaN(currentValue) && currentValue > 0) {
                    if (previousRatioUnit === 'gallons' && currentUnit === 'fluidounces') {
                        volumeInput.value = (currentValue * 128).toFixed(0);
                    } else if (previousRatioUnit === 'fluidounces' && currentUnit === 'gallons') {
                        volumeInput.value = parseFloat((currentValue / 128).toFixed(2));
                    }
                }
                unitLabel.textContent = currentUnit === 'fluidounces' ? 'fl oz' : 'gal';
            }

            previousRatioUnit = currentUnit;
            updateRatioDisplay();
        }

        function updateRatioDisplay() {
            // Only update if we have calculated values
            if (calculatedRatioTotal === 0) return;

            const unit = document.getElementById('ratioUnitToggle').value;
            const isMillilitres = unit === 'millilitres';
            const isGallons = unit === 'gallons';
            const isFluidOunces = unit === 'fluidounces';

            if (isMillilitres) {
                const chemicalMl = calculatedRatioChemical * 1000;
                const waterMl = calculatedRatioWater * 1000;
                const totalMl = calculatedRatioTotal * 1000;

                document.getElementById('ratioChemicalAmount').textContent = `${chemicalMl.toFixed(0)} ml`;
                document.getElementById('ratioWaterAmount').textContent = `${waterMl.toFixed(0)} ml`;
                document.getElementById('ratioTotalAmount').textContent = `${totalMl.toFixed(0)} ml`;
            } else if (isGallons) {
                const chemicalGal = calculatedRatioChemical / 3.78541;
                const waterGal = calculatedRatioWater / 3.78541;
                const totalGal = calculatedRatioTotal / 3.78541;

                document.getElementById('ratioChemicalAmount').textContent = 
                    `${parseFloat(chemicalGal.toFixed(2))} gal`;
                document.getElementById('ratioWaterAmount').textContent = 
                    `${parseFloat(waterGal.toFixed(2))} gal`;
                document.getElementById('ratioTotalAmount').textContent = 
                    `${parseFloat(totalGal.toFixed(2))} gal`;
            } else if (isFluidOunces) {
                const chemicalFlOz = calculatedRatioChemical * 33.814;
                const waterFlOz = calculatedRatioWater * 33.814;
                const totalFlOz = calculatedRatioTotal * 33.814;

                document.getElementById('ratioChemicalAmount').textContent = 
                    `${parseFloat(chemicalFlOz.toFixed(1))} fl oz`;
                document.getElementById('ratioWaterAmount').textContent = 
                    `${parseFloat(waterFlOz.toFixed(1))} fl oz`;
                document.getElementById('ratioTotalAmount').textContent = 
                    `${parseFloat(totalFlOz.toFixed(1))} fl oz`;
            } else {
                document.getElementById('ratioChemicalAmount').textContent = 
                    `${parseFloat(calculatedRatioChemical.toFixed(3))} L`;
                document.getElementById('ratioWaterAmount').textContent = 
                    `${parseFloat(calculatedRatioWater.toFixed(3))} L`;
                document.getElementById('ratioTotalAmount').textContent = 
                    `${parseFloat(calculatedRatioTotal.toFixed(3))} L`;
            }
        }

        function calculateRatio() {
            let totalVolume = parseFloat(document.getElementById('ratioTotalVolume').value);
            const chemicalParts = parseFloat(document.getElementById('ratioChemical').value);
            const waterParts = parseFloat(document.getElementById('ratioWater').value);
            const unit = document.getElementById('ratioUnitToggle').value;

            // Convert to litres if in millilitres, gallons, or fluid ounces
            if (unit === 'millilitres') {
                totalVolume = totalVolume / 1000;
            } else if (unit === 'gallons') {
                totalVolume = totalVolume * 3.78541;
            } else if (unit === 'fluidounces') {
                totalVolume = totalVolume * 0.0295735; // fl oz to litres
            }

            // Validate inputs
            if (isNaN(totalVolume) || isNaN(chemicalParts) || isNaN(waterParts)) {
                alert('Please enter valid numbers for all fields.');
                return;
            }

            if (totalVolume <= 0 || chemicalParts <= 0 || waterParts <= 0) {
                alert('All values must be greater than 0.');
                return;
            }

            // Calculate amounts
            const totalParts = chemicalParts + waterParts;
            const chemicalAmount = (chemicalParts / totalParts) * totalVolume;
            const waterAmount = (waterParts / totalParts) * totalVolume;

            // Store calculated values globally
            calculatedRatioChemical = chemicalAmount;
            calculatedRatioWater = waterAmount;
            calculatedRatioTotal = totalVolume;

            // Show results
            document.getElementById('ratio-results').classList.add('show');

            // Update display based on selected unit
            updateRatioDisplay();
        }

        // Global variables to store calculation results for SH calculator
        let calculatedHypoLitres = 0;
        let calculatedWaterLitres = 0;
        let calculatedSurfactantLitres = 0;
        let calculatedTankSize = 0;
        let calculatedConcentrate = 0;
        let previousUnit = document.getElementById('unitToggle') ? document.getElementById('unitToggle').value : 'litres';

        function convertTankSizeUnit() {
            const currentUnit = document.getElementById('unitToggle').value;
            const tankSizeInput = document.getElementById('tankSize');
            const surfactantInput = document.getElementById('surfactant');
            const concentrateInput = document.getElementById('concentrate');
            const unitLabel = document.getElementById('tankSizeUnit');
            let currentValue = parseFloat(tankSizeInput.value);

            // If no change, do nothing
            if (previousUnit === currentUnit) {
                return;
            }

            // Determine if we're switching between UK and US systems or within a system
            const ukUnits = ['litres', 'millilitres'];
            const usUnits = ['gallons', 'fluidounces'];
            
            const previousIsUK = ukUnits.includes(previousUnit);
            const currentIsUK = ukUnits.includes(currentUnit);
            const previousIsUS = usUnits.includes(previousUnit);
            const currentIsUS = usUnits.includes(currentUnit);

            // Switching between UK and US systems - reset to defaults
            if ((previousIsUK && currentIsUS) || (previousIsUS && currentIsUK)) {
                // Hide results when switching between systems
                document.getElementById('results').classList.remove('show');
                calculatedHypoLitres = 0;
                calculatedWaterLitres = 0;
                calculatedSurfactantLitres = 0;
                calculatedTankSize = 0;
                calculatedConcentrate = 0;
                
                if (currentIsUS) {
                    // Switching to US system
                    if (currentUnit === 'fluidounces') {
                        tankSizeInput.value = 640; // 5 gallons = 640 fl oz
                    } else {
                        tankSizeInput.value = 5;
                    }
                    surfactantInput.value = 8;
                    concentrateInput.value = 12.5;
                    unitLabel.textContent = currentUnit === 'fluidounces' ? 'fl oz' : 'gal';
                } else {
                    // Switching to UK system
                    if (currentUnit === 'millilitres') {
                        tankSizeInput.value = 5000;
                    } else {
                        tankSizeInput.value = 5;
                    }
                    surfactantInput.value = 20;
                    concentrateInput.value = 15;
                    unitLabel.textContent = currentUnit === 'millilitres' ? 'ml' : 'L';
                }
            } 
            // Converting within UK system (litres ‚Üî millilitres)
            else if (previousIsUK && currentIsUK) {
                if (!isNaN(currentValue) && currentValue > 0) {
                    if (previousUnit === 'litres' && currentUnit === 'millilitres') {
                        tankSizeInput.value = (currentValue * 1000).toFixed(0);
                    } else if (previousUnit === 'millilitres' && currentUnit === 'litres') {
                        tankSizeInput.value = parseFloat((currentValue / 1000).toFixed(2));
                    }
                }
                unitLabel.textContent = currentUnit === 'millilitres' ? 'ml' : 'L';
            }
            // Converting within US system (gallons ‚Üî fluid ounces)
            else if (previousIsUS && currentIsUS) {
                if (!isNaN(currentValue) && currentValue > 0) {
                    if (previousUnit === 'gallons' && currentUnit === 'fluidounces') {
                        tankSizeInput.value = (currentValue * 128).toFixed(0);
                    } else if (previousUnit === 'fluidounces' && currentUnit === 'gallons') {
                        tankSizeInput.value = parseFloat((currentValue / 128).toFixed(2));
                    }
                }
                unitLabel.textContent = currentUnit === 'fluidounces' ? 'fl oz' : 'gal';
            }

            previousUnit = currentUnit;
            updateDisplay();
        }

        function updateDisplay() {
            // Only update if we have calculated values
            if (calculatedTankSize === 0) return;

            const unit = document.getElementById('unitToggle').value;
            const isMillilitres = unit === 'millilitres';
            const isGallons = unit === 'gallons';
            const isFluidOunces = unit === 'fluidounces';

            // Convert and display results
            if (isMillilitres) {
                const hypoMl = calculatedHypoLitres * 1000;
                const waterMl = calculatedWaterLitres * 1000;
                const surfactantMl = calculatedSurfactantLitres * 1000;
                const totalMl = calculatedTankSize * 1000;

                // Update the result values only (not the entire HTML structure)
                const resultItems = document.querySelectorAll('.result-item');
                resultItems[0].querySelector('.result-value').innerHTML = 
                    `${hypoMl.toFixed(0)} ml`;
                resultItems[1].querySelector('.result-value').innerHTML = 
                    `${waterMl.toFixed(0)} ml`;
                resultItems[2].querySelector('.result-value').innerHTML = 
                    `${surfactantMl.toFixed(0)} ml`;
                resultItems[3].querySelector('.result-value').innerHTML = 
                    `${totalMl.toFixed(0)} ml`;
            } else if (isGallons) {
                const hypoGal = calculatedHypoLitres / 3.78541;
                const waterGal = calculatedWaterLitres / 3.78541;
                const surfactantFlOz = calculatedSurfactantLitres * 33.814; // Convert litres to fl oz
                const surfactantGal = calculatedSurfactantLitres / 3.78541;
                const totalGal = calculatedTankSize / 3.78541;

                // Update the result values only (not the entire HTML structure)
                const resultItems = document.querySelectorAll('.result-item');
                resultItems[0].querySelector('.result-value').innerHTML = 
                    `${parseFloat(hypoGal.toFixed(2))} gal`;
                resultItems[1].querySelector('.result-value').innerHTML = 
                    `${parseFloat(waterGal.toFixed(2))} gal`;
                resultItems[2].querySelector('.result-value').innerHTML = 
                    `${parseFloat(surfactantFlOz.toFixed(1))} fl oz (${parseFloat(surfactantGal.toFixed(2))} gal)`;
                resultItems[3].querySelector('.result-value').innerHTML = 
                    `${parseFloat(totalGal.toFixed(2))} gal`;
            } else if (isFluidOunces) {
                const hypoFlOz = calculatedHypoLitres * 33.814;
                const waterFlOz = calculatedWaterLitres * 33.814;
                const surfactantFlOz = calculatedSurfactantLitres * 33.814;
                const totalFlOz = calculatedTankSize * 33.814;

                // Update the result values only (not the entire HTML structure)
                const resultItems = document.querySelectorAll('.result-item');
                resultItems[0].querySelector('.result-value').innerHTML = 
                    `${parseFloat(hypoFlOz.toFixed(1))} fl oz`;
                resultItems[1].querySelector('.result-value').innerHTML = 
                    `${parseFloat(waterFlOz.toFixed(1))} fl oz`;
                resultItems[2].querySelector('.result-value').innerHTML = 
                    `${parseFloat(surfactantFlOz.toFixed(1))} fl oz`;
                resultItems[3].querySelector('.result-value').innerHTML = 
                    `${parseFloat(totalFlOz.toFixed(1))} fl oz`;
            } else {
                const hypoMl = calculatedHypoLitres * 1000;
                const waterMl = calculatedWaterLitres * 1000;
                const surfactantMl = calculatedSurfactantLitres * 1000;

                // Update the result values only (not the entire HTML structure)
                const resultItems = document.querySelectorAll('.result-item');
                resultItems[0].querySelector('.result-value').innerHTML = 
                    `${parseFloat(calculatedHypoLitres.toFixed(3))} L`;
                resultItems[1].querySelector('.result-value').innerHTML = 
                    `${parseFloat(calculatedWaterLitres.toFixed(3))} L`;
                resultItems[2].querySelector('.result-value').innerHTML = 
                    `${surfactantMl.toFixed(0)} ml (${parseFloat(calculatedSurfactantLitres.toFixed(3))} L)`;
                resultItems[3].querySelector('.result-value').innerHTML = 
                    `${parseFloat(calculatedTankSize.toFixed(3))} L`;
            }

            // Update ratio (stays the same regardless of units)
            const ratio = calculatedWaterLitres / calculatedHypoLitres;
            const roundedRatio = Math.round(ratio * 10) / 10; // Round to 1 decimal place
            const ratioDisplay = roundedRatio % 1 === 0 ? roundedRatio.toFixed(0) : roundedRatio.toFixed(1);
            document.getElementById('ratio').textContent = `1:${ratioDisplay} (Sodium Hypochlorite:Water)`;
            
            // Calculate and display dilution ratio (hypo:water)
            const dilutionRatio = calculatedWaterLitres / calculatedHypoLitres;
            const roundedDilution = Math.round(dilutionRatio * 10) / 10; // Round to 1 decimal place
            const dilutionDisplay = roundedDilution % 1 === 0 ? roundedDilution.toFixed(0) : roundedDilution.toFixed(1);
            document.getElementById('dilutionRatio').textContent = `1:${dilutionDisplay}`;
            
            // Display the final strength info
            const desiredStrength = (calculatedHypoLitres * calculatedConcentrate) / calculatedTankSize;
            document.getElementById('finalStrength').textContent = desiredStrength.toFixed(1);
            document.getElementById('concentrateStrength').textContent = calculatedConcentrate.toFixed(1);
        }

        function calculate() {
            // Get input values
            let tankSize = parseFloat(document.getElementById('tankSize').value);
            const concentrate = parseFloat(document.getElementById('concentrate').value);
            const desired = parseFloat(document.getElementById('desired').value);
            const surfactantPerLitre = parseFloat(document.getElementById('surfactant').value);
            const unit = document.getElementById('unitToggle').value;

            // Convert tank size to litres if in millilitres, gallons, or fluid ounces
            if (unit === 'millilitres') {
                tankSize = tankSize / 1000;
            } else if (unit === 'gallons') {
                tankSize = tankSize * 3.78541;
            } else if (unit === 'fluidounces') {
                tankSize = tankSize * 0.0295735; // fl oz to litres
            }

            // Validate inputs
            if (isNaN(tankSize) || isNaN(concentrate) || isNaN(desired) || isNaN(surfactantPerLitre)) {
                alert('Please enter valid numbers for all fields.');
                return;
            }

            if (tankSize <= 0) {
                alert('Tank size must be greater than 0.');
                return;
            }

            if (concentrate <= 0 || concentrate > 15) {
                alert('Concentrate strength must be between 0.1% and 15%.');
                return;
            }

            if (desired <= 0 || desired > concentrate) {
                alert('Desired strength must be between 0.1% and your concentrate strength.');
                return;
            }

            if (surfactantPerLitre < 0) {
                alert('Surfactant amount cannot be negative.');
                return;
            }

            // Calculate sodium hypochlorite needed (C1V1 = C2V2)
            const hypoLitres = (desired * tankSize) / concentrate;
            
            // Calculate water needed
            const waterLitres = tankSize - hypoLitres;

            // Calculate surfactant needed based on total volume
            const surfactantMl = surfactantPerLitre * tankSize;
            const surfactantLitres = surfactantMl / 1000;

            // Store calculated values globally
            calculatedHypoLitres = hypoLitres;
            calculatedWaterLitres = waterLitres;
            calculatedSurfactantLitres = surfactantLitres;
            calculatedTankSize = tankSize;
            calculatedConcentrate = concentrate;

            // Display concentrate strength
            document.getElementById('concentrateDisplay').textContent = concentrate.toFixed(1);

            // Show results
            document.getElementById('results').classList.add('show');

            // Update display based on selected unit
            updateDisplay();
        }

        // Reset Sodium Hypochlorite calculator to defaults
        function resetSH() {
            const currentUnit = document.getElementById('unitToggle').value;
            
            // Reset based on current unit
            if (currentUnit === 'gallons') {
                document.getElementById('tankSize').value = 5;
                document.getElementById('surfactant').value = 8;
                document.getElementById('concentrate').value = 12.5;
            } else if (currentUnit === 'fluidounces') {
                document.getElementById('tankSize').value = 640; // 5 gallons = 640 fl oz
                document.getElementById('surfactant').value = 8;
                document.getElementById('concentrate').value = 12.5;
            } else if (currentUnit === 'millilitres') {
                document.getElementById('tankSize').value = 5000;
                document.getElementById('surfactant').value = 20;
                document.getElementById('concentrate').value = 15;
            } else {
                document.getElementById('tankSize').value = 5;
                document.getElementById('surfactant').value = 20;
                document.getElementById('concentrate').value = 15;
            }
            
            document.getElementById('desired').value = 3;
            document.getElementById('results').classList.remove('show');
            
            // Reset calculated values
            calculatedHypoLitres = 0;
            calculatedWaterLitres = 0;
            calculatedSurfactantLitres = 0;
            calculatedTankSize = 0;
            calculatedConcentrate = 0;
        }

        // Reset Chemical Ratio calculator to defaults
        function resetRatio() {
            const currentUnit = document.getElementById('ratioUnitToggle').value;
            
            // Reset based on current unit
            if (currentUnit === 'gallons') {
                document.getElementById('ratioTotalVolume').value = 5;
            } else if (currentUnit === 'fluidounces') {
                document.getElementById('ratioTotalVolume').value = 640; // 5 gallons = 640 fl oz
            } else if (currentUnit === 'millilitres') {
                document.getElementById('ratioTotalVolume').value = 5000;
            } else {
                document.getElementById('ratioTotalVolume').value = 5;
            }
            
            document.getElementById('ratioChemical').value = 1;
            document.getElementById('ratioWater').value = 1;
            document.getElementById('ratio-results').classList.remove('show');
            
            // Reset calculated values
            calculatedRatioChemical = 0;
            calculatedRatioWater = 0;
            calculatedRatioTotal = 0;
        }

        // Allow Enter key to calculate
        document.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                calculate();
            }
        });
    </script>
</body>
</html>